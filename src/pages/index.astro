---
import '../styles/global.css';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta
      name="description"
      content="A playful Valentine page with a rotating name reveal and envelope letter animation."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Nunito+Sans:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap"
      rel="stylesheet"
    />
    <title>Happy Valentine's</title>
  </head>
  <body>
    <video id="bg-video" class="bg-video" playsinline muted loop preload="metadata" aria-hidden="true">
      <source src="/roses_falling.mp4" type="video/mp4" />
    </video>

    <main class="hero-root relative flex items-center justify-center overflow-hidden px-4 py-4 sm:px-6 sm:py-6">
      <img
        src="/nemo.png"
        alt="Nemo" 
        class="nemo-corner"
        loading="lazy"
        decoding="async"
      />

      <section class="hero-content relative mx-auto w-full max-w-4xl text-center">
        <h1
          class="mx-auto max-w-3xl text-balance text-[clamp(2.2rem,7vw,5rem)] font-display font-semibold leading-tight text-[var(--ink)] drop-shadow-sm"
        >
          <span class="heading-line">Happy Valentine's</span>
          <span class="name-line">
            <button
              id="name-toggle"
              type="button"
              class="name-button name-button-attention"
              aria-label="Rotate name"
              title="Tap here"
            >
              Sara
            </button>
            <span id="name-tooltip" class="name-tooltip" role="status" aria-label="Tap name">
              <img src="/hand_press.png" alt="" class="name-hand" aria-hidden="true" />
            </span>
          </span>
        </h1>

        <p class="mx-auto mt-7 max-w-2xl text-[clamp(1rem,2.5vw,1.4rem)] text-[color-mix(in_hsl,var(--ink)_82%,white)]">
          Since we are not in the same country to celebrate today... I built this for you.
        </p>

        <div class="letter-stage mx-auto w-full max-w-xl">
          <article id="letter-card" class="letter-card" aria-live="polite">
            <h2 class="mb-4 text-center text-3xl font-handwritten font-semibold tracking-wide text-[var(--ink)]">
              My Letter For You
            </h2>
            <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
            <p>
              Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown
              printer took a galley of type and scrambled it to make a type specimen book. It has survived not
              only five centuries,
            </p>
            <p>
              but also the leap into electronic typesetting,
              remaining essentially unchanged.
              It was popularised in the 1960s with
            </p>
            <p>
              the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop
              publishing software like Aldus PageMaker including versions of Lorem Ipsum.
            </p>
          </article>

          <div id="open-letter-shell" class="envelope-shell">
            <span class="envelope-glow" aria-hidden="true"></span>
            <button
              id="open-letter"
              type="button"
              class="envelope-button"
              aria-expanded="false"
              aria-controls="letter-card"
            >
              <span class="envelope-label">open me</span>
            </button>
          </div>
          
        </div>
      </section>
    </main>

    <script is:inline>
      const names = [
        { label: 'Sara', theme: 'sara' },
        { label: 'Kainat', theme: 'kainat' },
        { label: 'Nemo', theme: 'nemo' },
        { label: 'Prettiest girl', theme: 'prettiest-girl' },
        { label: 'Fairest of them all', theme: 'fairest-of-them-all' },
      ];

      let currentIndex = 0;

      const root = document.documentElement;
      const nameToggle = document.getElementById('name-toggle');
      const nameTooltip = document.getElementById('name-tooltip');
      const backgroundVideo = document.getElementById('bg-video');
      const letterStage = document.querySelector('.letter-stage');
      const openLetterShell = document.getElementById('open-letter-shell');
      const openLetterButton = document.getElementById('open-letter');
      const letterCard = document.getElementById('letter-card');

      root.setAttribute('data-theme', names[currentIndex].theme);

      const hideTooltip = () => {
        nameTooltip?.classList.add('name-tooltip-hidden');
        nameToggle?.classList.remove('name-button-attention');
      };

      const pulseGradient = () => {
        document.body.classList.add('gradient-shift');
        window.setTimeout(() => {
          document.body.classList.remove('gradient-shift');
        }, 900);
      };

      const applyName = (nextIndex) => {
        currentIndex = nextIndex % names.length;
        const nextName = names[currentIndex];

        nameToggle?.classList.remove('name-in');
        nameToggle?.classList.add('name-out');

        window.setTimeout(() => {
          if (!nameToggle) {
            return;
          }

          nameToggle.textContent = nextName.label;
          root.setAttribute('data-theme', nextName.theme);
          pulseGradient();

          nameToggle.classList.remove('name-out');
          nameToggle.classList.add('name-in');

          window.setTimeout(() => {
            nameToggle.classList.remove('name-in');
          }, 360);
        }, 160);
      };

      nameToggle?.addEventListener('click', () => {
        hideTooltip();
        applyName(currentIndex + 1);
      });

      nameToggle?.addEventListener('mouseenter', hideTooltip);
      nameToggle?.addEventListener('focus', hideTooltip);

      const createRipple = (event) => {
        if (!openLetterButton) {
          return;
        }

        const ripple = document.createElement('span');
        ripple.className = 'ripple';

        const rect = openLetterButton.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);

        ripple.style.width = `${size}px`;
        ripple.style.height = `${size}px`;
        ripple.style.left = `${event.clientX - rect.left - size / 2}px`;
        ripple.style.top = `${event.clientY - rect.top - size / 2}px`;

        openLetterButton.querySelectorAll('.ripple').forEach((node) => node.remove());
        openLetterButton.appendChild(ripple);
      };

      openLetterButton?.addEventListener('click', (event) => {
        createRipple(event);
        letterCard?.classList.toggle('letter-open');
        openLetterButton.classList.toggle('opened');
        openLetterShell?.classList.toggle('opened');
        const isOpen = letterCard?.classList.contains('letter-open') ?? false;
        letterStage?.classList.toggle('stage-open', isOpen);
        openLetterButton.setAttribute('aria-expanded', String(isOpen));

        document.body.classList.toggle('video-bg-active', isOpen);
        if (!backgroundVideo) {
          return;
        }

        if (isOpen) {
          backgroundVideo.currentTime = 0;
          backgroundVideo.play().catch(() => {});
          return;
        }

        backgroundVideo.pause();
        backgroundVideo.currentTime = 0;
      });
    </script>
  </body>
</html>

<style>
  html,
  body {
    height: 100%;
    overflow: hidden;
  }

  .hero-root {
    width: 100%;
    height: 100dvh;
    max-height: 100dvh;
    z-index: 1;
  }

  .bg-video {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    pointer-events: none;
    z-index: 0;
    transition: opacity 550ms ease;
  }

  body.video-bg-active {
    animation: none;
    background: #12050c;
  }

  body.video-bg-active .bg-video {
    opacity: 1;
  }

  .hero-content {
    display: flex;
    height: 100%;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: clamp(0.7rem, 2vh, 1.4rem);
    padding-block: clamp(0.3rem, 1.5vh, 1rem);
    z-index: 2;
  }

  .nemo-corner {
    position: absolute;
    left: clamp(0.4rem, 2vw, 1.3rem);
    bottom: clamp(0.35rem, 1.8vh, 1rem);
    width: clamp(112px, 21vw, 250px);
    border-radius: 0;
    box-shadow: none;
    background: transparent;
    opacity: 0;
    transform: translateY(16px) scale(0.92);
    transition: opacity 380ms ease, transform 380ms ease;
    pointer-events: none;
    z-index: 1;
  }

  :global(:root[data-theme='nemo']) .nemo-corner {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .name-button {
    position: relative;
    appearance: none;
    margin-left: 0;
    border: 0;
    border-bottom: 0;
    padding: 0;
    background: none;
    color: var(--name);
    font: inherit;
    font-weight: inherit;
    line-height: inherit;
    text-decoration: none;
    vertical-align: baseline;
    cursor: pointer;
    transition: color 280ms ease;
  }

  .heading-line {
    display: block;
  }

  .name-line {
    position: relative;
    display: inline-flex;
    margin-top: 0.02em;
    align-items: baseline;
  }

  .name-button-attention {
    text-shadow: 0 0 0 rgba(0, 0, 0, 0);
    animation: nameHint 2.2s ease-in-out infinite;
  }

  .name-button-attention::after {
    content: none;
    display: none;
  }

  .name-button:hover {
    color: color-mix(in hsl, var(--name) 86%, white);
  }

  .name-button:focus-visible {
    outline: 2px solid color-mix(in hsl, var(--name) 45%, white);
    outline-offset: 2px;
    border-radius: 0.18em;
  }

  .name-tooltip {
    position: absolute;
    left: 50%;
    top: calc(60% + 0.6rem);
    transform: translateX(-50%);
    display: inline-flex;
    opacity: 0.6;
    animation: handFloat 1.8s ease-in-out infinite;
    transition: opacity 280ms ease, transform 280ms ease;
    pointer-events: none;
  }

  .name-hand {
    width: clamp(44px, 8.2vw, 74px);
    height: auto;
    object-fit: contain;
    filter: drop-shadow(0 6px 10px rgba(17, 6, 12, 0.26));
    animation: handTap 1.1s ease-in-out infinite;
  }

  .name-tooltip-hidden {
    opacity: 0;
    transform: translate(-50%, 8px) scale(0.96);
    pointer-events: none;
    animation: none;
  }

  .name-out {
    animation: nameOut 170ms ease-in forwards;
  }

  .name-in {
    animation: nameIn 320ms cubic-bezier(0.17, 0.67, 0.35, 1.34);
  }

  @keyframes nameOut {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    100% {
      opacity: 0;
      transform: translateY(-8px) scale(0.9);
    }
  }

  @keyframes nameIn {
    0% {
      opacity: 0;
      transform: translateY(10px) scale(0.92);
    }

    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  @keyframes handFloat {
    0%,
    100% {
      transform: translateX(-50%) translateY(0);
    }

    50% {
      transform: translateX(-50%) translateY(-4px);
    }
  }

  @keyframes handTap {
    0%,
    100% {
      transform: translateY(-1px) scale(1) rotate(-2deg);
    }

    45% {
      transform: translateY(6px) scale(0.95) rotate(0deg);
    }

    70% {
      transform: translateY(2px) scale(1.01) rotate(-1deg);
    }
  }

  @keyframes nameHint {
    0%,
    100% {
      text-shadow: 0 0 0 rgba(0, 0, 0, 0);
      filter: saturate(1);
    }

    50% {
      text-shadow: 0 4px 14px color-mix(in hsl, var(--name) 28%, transparent);
      filter: saturate(1.12);
    }
  }

  @keyframes nameHintLine {
    0%,
    100% {
      opacity: 0.6;
      transform: scaleX(0.55);
    }

    50% {
      opacity: 1;
      transform: scaleX(1);
    }
  }

  .letter-stage {
    position: relative;
    height: clamp(112px, 14vh, 156px);
    min-height: 112px;
    margin-top: clamp(0.2rem, 0.8vh, 0.5rem);
    perspective: 1300px;
    transition: height 520ms cubic-bezier(0.2, 0.7, 0.2, 1);
  }

  .letter-stage.stage-open {
    height: min(48vh, 460px);
  }

  .envelope-shell {
    position: absolute;
    left: 50%;
    bottom: 0;
    transform: translateX(-50%);
    width: min(90vw, 300px);
    height: 92px;
    isolation: isolate;
  }

  .envelope-glow {
    position: absolute;
    inset: -6px;
    border-radius: 1.2rem;
    background: linear-gradient(115deg, #ef4444 0%, #8b5cf6 52%, #ec4899 100%);
    filter: blur(8px);
    opacity: 0.7;
    transition: opacity 420ms ease, filter 420ms ease, transform 420ms ease;
    pointer-events: none;
    z-index: 0;
  }

  .envelope-shell:hover .envelope-glow,
  .envelope-shell:focus-within .envelope-glow,
  .envelope-shell.opened .envelope-glow {
    opacity: 0.45;
    filter: blur(16px);
    transform: scale(1.02);
  }

  .envelope-button {
    position: relative;
    z-index: 1;
    width: 100%;
    height: 100%;
    border: 0;
    border-radius: 1rem;
    background: transparent;
    cursor: pointer;
    overflow: hidden;
    box-shadow: 0 18px 32px color-mix(in hsl, var(--ink) 25%, transparent);
    transition: transform 360ms ease, box-shadow 360ms ease, filter 360ms ease;
  }

  .envelope-button::before,
  .envelope-button::after {
    content: '';
    position: absolute;
    inset: 0;
  }

  .envelope-button::before {
    background: linear-gradient(155deg, #ff6f91 0%, #ff3f73 100%);
  }

  .envelope-button::after {
    top: 0;
    height: 72%;
    background: linear-gradient(160deg, #ffb3c6 0%, #ff88a6 100%);
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    transform-origin: top center;
    transition: transform 600ms cubic-bezier(0.2, 0.7, 0.2, 1);
    z-index: 2;
  }

  .envelope-button:hover {
    transform: translateY(-4px);
    box-shadow: 0 22px 35px color-mix(in hsl, var(--ink) 30%, transparent);
    filter: saturate(1.06);
  }

  .envelope-button.opened::after {
    transform: rotateX(175deg);
  }

  .envelope-button.opened {
    transform: translateY(2px);
  }

  .envelope-label {
    position: relative;
    z-index: 3;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    width: 100%;
    text-transform: uppercase;
    letter-spacing: 0.22em;
    font-weight: 700;
    font-size: 0.86rem;
    color: #fff8fb;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.22);
  }

  .ripple {
    position: absolute;
    border-radius: 999px;
    transform: scale(0);
    background: rgba(255, 255, 255, 0.5);
    animation: rippleWave 680ms ease-out;
    z-index: 4;
    pointer-events: none;
  }

  @keyframes rippleWave {
    to {
      transform: scale(2.6);
      opacity: 0;
    }
  }

  .letter-card {
    position: absolute;
    left: 50%;
    bottom: 58px;
    transform: translateX(-50%) translateY(145px) rotateX(-18deg) scale(0.9);
    width: min(92vw, 470px);
    border-radius: 1rem;
    padding: 1.5rem 1.5rem 1.8rem;
    border: 1px solid color-mix(in hsl, var(--paper-line) 45%, transparent);
    background:
      repeating-linear-gradient(
        to bottom,
        color-mix(in hsl, var(--paper) 96%, white) 0,
        color-mix(in hsl, var(--paper) 96%, white) 28px,
        color-mix(in hsl, var(--paper-line) 45%, white) 29px
      );
    box-shadow: 0 20px 45px var(--paper-shadow);
    transform-origin: bottom center;
    opacity: 0;
    pointer-events: none;
    transition: transform 700ms cubic-bezier(0.16, 0.74, 0.26, 1), opacity 500ms ease;
    z-index: 1;
  }

  .letter-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 1.1rem;
    width: 3px;
    height: 100%;
    background: color-mix(in hsl, #f06f88 40%, transparent);
    opacity: 0.5;
  }

  .letter-card p {
    margin: 0 0 0.85rem;
    font-family: var(--font-handwritten);
    font-size: clamp(1.18rem, 2.6vw, 1.55rem);
    line-height: 1.2;
    text-align: left;
    color: color-mix(in hsl, var(--ink) 88%, #2f1a24);
  }

  .letter-open {
    transform: translateX(-50%) translateY(-8px) rotateX(0) scale(1);
    opacity: 1;
    pointer-events: auto;
  }

  @media (max-width: 640px) {
    .nemo-corner {
      width: clamp(98px, 30vw, 156px);
    }

    .letter-stage {
      height: clamp(104px, 13vh, 140px);
      min-height: 104px;
    }

    .letter-stage.stage-open {
      height: min(46vh, 390px);
    }

    .letter-card {
      padding: 1.2rem 1.1rem 1.4rem;
      bottom: 62px;
    }

    .envelope-shell {
      height: 86px;
    }

    .name-tooltip {
      font-size: 0.72rem;
    }
  }
</style>
